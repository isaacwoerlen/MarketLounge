(function () {
  document.addEventListener("DOMContentLoaded", function () {
    const code = document.getElementById("id_code");
    const name = document.getElementById("id_name");
    const isActive = document.getElementById("id_is_active");
    const isDefault = document.getElementById("id_is_default");
    if (!code || !name || !isActive || !isDefault) return;

    function normalizeCode(value) {
      if (!value) return "";
      const parts = String(value).trim().split("-");
      const lang = (parts[0] || "").toLowerCase();
      const region = parts.length > 1 ? (parts[1] || "").toUpperCase() : "";
      return region ? `${lang}-${region}` : lang;
    }

    // Normalise le code et pré-remplit le nom si vide
    code.addEventListener("blur", () => {
      const n = normalizeCode(code.value);
      if (code.value !== n) code.value = n;
      if (!name.value) {
        const preset = { fr: "Français", en: "English" };
        name.value = preset[n] || n.toUpperCase();
      }
    });

    // Si "par défaut" => forcer active
    isDefault.addEventListener("change", () => {
      if (isDefault.checked) isActive.checked = true;
    });

    // Empêche de désactiver une langue par défaut
    isActive.addEventListener("change", () => {
      if (!isActive.checked && isDefault.checked) {
        isActive.checked = true;
        let warn = document.getElementById("lang-warn");
        if (!warn) {
          warn = document.createElement("div");
          warn.id = "lang-warn";
          warn.style.color = "#b11";
          warn.style.marginTop = "6px";
          warn.style.fontSize = "0.9em";
          warn.textContent = "La langue par défaut doit rester active.";
          const form = document.querySelector("form");
          if (form) form.appendChild(warn);
        }
      }
    });
  });
})();
