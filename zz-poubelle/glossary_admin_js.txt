(function () {
  // 🌍 Titres possibles selon langue
  const TITLES = {
    definition: ["Définition", "Definition"],
    procede: ["Procédé", "Process", "Procedure"],
    technique: ["Explication technique", "Technical explanation"]
  };

  // 🔍 Trouve un fieldset par titre (multi-langue)
  function fs(key) {
    return Array.from(document.querySelectorAll("fieldset")).find(f => {
      const h = f.querySelector("h2");
      return h && TITLES[key].some(t => h.innerText.trim().includes(t));
    });
  }

  // ✨ Effets visuels
  function fadeOut(el) {
    if (!el) return;
    el.style.transition = "opacity 0.3s ease";
    el.style.opacity = 0;
    setTimeout(() => { el.style.display = "none"; }, 300);
  }

  function fadeIn(el) {
    if (!el) return;
    el.style.display = "";
    el.style.opacity = 0;
    el.style.transition = "opacity 0.3s ease";
    setTimeout(() => { el.style.opacity = 1; }, 10);
  }

  // 🧠 Applique la logique métier
  function apply() {
    const t = document.getElementById("id_type");
    if (!t) return;
    const v = t.value;

    const fDef = fs("definition");
    const fProc = fs("procede");
    const fTech = fs("technique");

    if (!fDef) console.warn("⚠️ Fieldset 'Définition' introuvable");
    if (!fProc) console.warn("⚠️ Fieldset 'Procédé' introuvable");
    if (!fTech) console.warn("⚠️ Fieldset 'Explication technique' introuvable");

    // Réinitialise
    [fDef, fProc, fTech].forEach(f => f && fadeIn(f));

    if (v === "metier") {
      fadeIn(fDef); fadeOut(fProc); fadeOut(fTech);
    }
    if (v === "operation") {
      fadeIn(fDef); fadeIn(fProc); fadeOut(fTech);
    }
    if (v === "variante") {
      fadeOut(fDef); fadeOut(fProc); fadeIn(fTech);
    }
  }

  document.addEventListener("DOMContentLoaded", apply);
  document.addEventListener("change", e => {
    if (e.target.id === "id_type") apply();
  });
})();
